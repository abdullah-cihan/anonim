<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Anonimleştirici | Final Sürüm</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- SheetJS (Excel İşlemleri İçin) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f1f5f9;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .dark-scroll::-webkit-scrollbar-thumb { background: #334155; }
        .dark-scroll::-webkit-scrollbar-track { background: #0f172a; }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 14px;
            width: 14px;
            border-radius: 50%;
            background: #2563eb;
            margin-top: -5px;
            box-shadow: 0 0 0 2px #ffffff;
            cursor: pointer;
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #2563eb; }
        .toggle-checkbox:checked + .toggle-label { background-color: #2563eb; }
        .toggle-checkbox { right: 18px; transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); }
        
        /* Glass Effect */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        .output-glass {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(16px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        .btn-modern {
            transition: all 0.2s ease;
        }
        .btn-modern:hover { transform: translateY(-1px); }
        .btn-modern:active { transform: translateY(0); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col font-sans overflow-hidden">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 z-50 flex-none">
        <div class="w-full px-6 h-14 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-7 h-7 bg-blue-600 rounded flex items-center justify-center shadow-sm shadow-blue-500/30">
                    <i class="fa-solid fa-shield-halved text-white text-xs"></i>
                </div>
                <h1 class="text-sm font-bold text-slate-800 uppercase tracking-wide">Pro Anonimleştirici</h1>
            </div>
            <div class="flex items-center gap-3">
                 <span class="hidden md:flex items-center gap-1.5 px-2 py-0.5 rounded bg-slate-100 border border-slate-200 text-[10px] font-medium text-slate-500">
                    <i class="fa-solid fa-server text-slate-400"></i> Client-Side Only
                </span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow w-full h-[calc(100vh-3.5rem)] p-4 overflow-hidden">
        <div class="flex flex-col lg:flex-row gap-4 h-full">
            
            <!-- 1. SOL PANEL: AYARLAR (Sidebar) -->
            <div class="w-full lg:w-72 flex-none flex flex-col h-full overflow-hidden">
                <div class="glass-panel rounded-xl p-4 h-full flex flex-col overflow-y-auto animate-in shadow-lg">
                    
                    <!-- Settings Header -->
                    <div class="flex items-center gap-2 mb-5 pb-3 border-b border-slate-100">
                        <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-600">
                            <i class="fa-solid fa-sliders text-sm"></i>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold text-slate-800 uppercase">Ayarlar</h3>
                            <p class="text-[10px] text-slate-500">Maskeleme Kuralları</p>
                        </div>
                    </div>

                    <div class="flex flex-col gap-5 flex-grow">
                        <!-- Sliders -->
                        <div class="space-y-4">
                            <div class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div class="flex justify-between mb-2">
                                    <label class="text-[11px] font-semibold text-slate-600">Ad Görünürlüğü</label>
                                    <span id="firstNameVal" class="text-[10px] font-bold bg-white border border-slate-200 text-blue-600 px-1.5 py-0.5 rounded">2 Harf</span>
                                </div>
                                <input type="range" id="firstNameRange" min="0" max="5" value="2" class="w-full">
                            </div>
                            <div class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div class="flex justify-between mb-2">
                                    <label class="text-[11px] font-semibold text-slate-600">Soyad Görünürlüğü</label>
                                    <span id="lastNameVal" class="text-[10px] font-bold bg-white border border-slate-200 text-blue-600 px-1.5 py-0.5 rounded">2 Harf</span>
                                </div>
                                <input type="range" id="lastNameRange" min="0" max="5" value="2" class="w-full">
                            </div>
                        </div>

                        <!-- Controls -->
                        <div class="space-y-3">
                            <div>
                                <label class="block text-[11px] font-semibold text-slate-500 mb-1.5">Maske Karakteri</label>
                                <div class="relative">
                                    <select id="maskChar" class="w-full appearance-none bg-white border border-slate-200 text-slate-700 text-xs rounded-lg p-2.5 focus:ring-1 focus:ring-blue-500 outline-none shadow-sm">
                                        <option value="*">* (Yıldız)</option>
                                        <option value=".">. (Nokta)</option>
                                        <option value="?">? (Soru)</option>
                                        <option value="x">x (Gizli)</option>
                                        <option value="█">█ (Blok)</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-400">
                                        <i class="fa-solid fa-chevron-down text-[10px]"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <label class="flex items-center justify-between p-2.5 bg-white border border-slate-200 rounded-lg cursor-pointer hover:border-blue-300 transition group shadow-sm">
                                <span class="text-[11px] font-medium text-slate-600">Sabit Uzunluk (***)</span>
                                <input type="checkbox" id="fixedLengthMask" class="w-3.5 h-3.5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                            </label>

                            <div class="flex justify-between items-center bg-white p-2.5 rounded-lg border border-slate-200 shadow-sm">
                                <label for="randomMode" class="text-[11px] font-medium text-slate-600 cursor-pointer">Rastgele Modu</label>
                                <div class="relative inline-block w-10 align-middle select-none">
                                    <input type="checkbox" name="randomMode" id="randomMode" class="toggle-checkbox absolute block w-4 h-4 top-[2px] rounded-full bg-white border border-slate-300 appearance-none cursor-pointer shadow-sm"/>
                                    <label for="randomMode" class="toggle-label block overflow-hidden h-5 rounded-full bg-slate-200 cursor-pointer"></label>
                                </div>
                            </div>
                            
                            <!-- Hidden checkbox logic -->
                            <input type="checkbox" id="middleNameFullMask" class="hidden" checked>
                            
                            <button onclick="document.getElementById('middleNameFullMask').click(); this.classList.toggle('bg-blue-50'); this.classList.toggle('border-blue-200'); this.classList.toggle('text-blue-600'); this.querySelector('i').classList.toggle('fa-eye-slash'); this.querySelector('i').classList.toggle('fa-eye');" class="w-full py-2 px-3 text-xs bg-slate-50 border border-slate-200 text-slate-600 rounded-lg flex items-center justify-center gap-2 hover:bg-slate-100 transition-colors bg-blue-50 border-blue-200 text-blue-600 font-medium">
                                <i class="fa-solid fa-eye-slash"></i>
                                <span>Ortanca İsmi Gizle</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- YouTube Card -->
                    <div class="mt-4 pt-4 border-t border-slate-100">
                        <a href="https://www.youtube.com/@teknolojikcozumvideo" target="_blank" class="block group">
                            <div class="bg-gradient-to-r from-red-50 to-white border border-red-100 rounded-xl p-3 flex items-center gap-3 transition-all hover:shadow-md hover:border-red-200">
                                <div class="w-10 h-10 bg-white rounded-lg shadow-sm flex items-center justify-center text-red-600 text-xl group-hover:scale-110 transition-transform">
                                    <i class="fa-brands fa-youtube"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-[10px] font-bold text-slate-800 truncate">Teknolojik Çözüm</p>
                                    <p class="text-[9px] font-medium text-red-500 uppercase tracking-wide">Videoları</p>
                                </div>
                                <i class="fa-solid fa-arrow-up-right-from-square text-[10px] text-slate-400 group-hover:text-red-500"></i>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- 2. SAĞ PANEL: GİRİŞ ve SONUÇ -->
            <div class="flex-1 flex flex-col gap-4 overflow-hidden h-full">
                
                <!-- ÜST: VERİ GİRİŞİ (INPUT) -->
                <div class="flex-1 glass-panel rounded-xl flex flex-col overflow-hidden animate-in shadow-lg" style="animation-delay: 0.1s;">
                    <!-- Toolbar -->
                    <div class="px-4 py-2 bg-white/60 border-b border-slate-100 flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-database text-blue-500 text-xs"></i>
                            <span class="text-xs font-bold text-slate-700 uppercase">Veri Kaynağı</span>
                        </div>
                        
                        <div class="flex gap-2">
                            <input type="file" id="fileInput" accept=".txt,.csv,.xlsx,.xls" class="hidden" onchange="handleFileUpload(this)">
                            <button onclick="document.getElementById('fileInput').click()" class="btn-modern px-3 py-1.5 rounded-lg bg-white border border-slate-200 text-xs font-medium text-slate-600 hover:text-blue-600 hover:border-blue-200 flex items-center gap-2 shadow-sm">
                                <i class="fa-solid fa-upload"></i> Yükle
                            </button>
                            <button onclick="clearInput()" class="btn-modern px-2 py-1.5 rounded-lg bg-white border border-slate-200 text-slate-400 hover:text-red-500 hover:border-red-200 shadow-sm" title="Temizle">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Excel Warning -->
                    <div id="columnSelectionArea" class="hidden bg-blue-50 border-b border-blue-100 px-4 py-2 animate-in">
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-blue-700 bg-blue-100 px-1.5 rounded">XLSX</span>
                            <select id="excelColumnSelect" onchange="loadSelectedColumn()" class="text-xs bg-white border-blue-200 text-slate-700 rounded-md py-1 pl-2 pr-6 focus:ring-1 focus:ring-blue-500 outline-none w-full sm:w-auto">
                            </select>
                        </div>
                    </div>

                    <!-- Editor -->
                    <div class="relative flex-grow bg-slate-50/30">
                        <textarea id="inputNames" class="w-full h-full p-4 bg-transparent border-0 resize-none font-mono text-sm text-slate-700 placeholder-slate-400 focus:ring-0 outline-none" placeholder="İsim listesini buraya yapıştırın..."></textarea>
                    </div>

                    <!-- Editor Footer Tools -->
                    <div class="px-3 py-2 bg-white border-t border-slate-100 flex flex-wrap gap-2 items-center justify-between">
                        <div class="flex gap-1">
                            <button onclick="changeCase('upper')" class="w-7 h-7 flex items-center justify-center rounded text-[10px] font-bold bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200" title="BÜYÜK HARF">AA</button>
                            <button onclick="changeCase('lower')" class="w-7 h-7 flex items-center justify-center rounded text-[10px] font-bold bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200" title="küçük harf">aa</button>
                            <button onclick="changeCase('title')" class="w-7 h-7 flex items-center justify-center rounded text-[10px] font-bold bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200" title="Baş Harf">Aa</button>
                        </div>
                        <div class="flex gap-2">
                             <button onclick="sortInput('asc')" class="px-3 py-1 rounded text-[10px] font-medium bg-slate-50 text-slate-600 border border-slate-200 hover:bg-slate-100">A-Z Sırala</button>
                             <button onclick="removeDuplicates()" class="px-3 py-1 rounded text-[10px] font-medium bg-slate-50 text-slate-600 border border-slate-200 hover:bg-slate-100">Tekilleştir</button>
                             <button onclick="fillSampleData()" class="px-3 py-1 rounded text-[10px] font-medium text-blue-600 hover:bg-blue-50">Örnek Veri</button>
                        </div>
                    </div>
                </div>

                <!-- ALT: KONSOL ÇIKTISI (OUTPUT) -->
                <div class="flex-1 output-glass rounded-xl flex flex-col overflow-hidden animate-in shadow-lg shadow-slate-900/10" style="animation-delay: 0.2s;">
                    <!-- Toolbar -->
                    <div class="px-4 py-2 bg-slate-800/80 border-b border-slate-700 flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-terminal text-emerald-500 text-xs"></i>
                            <span class="text-xs font-bold text-slate-300 uppercase">Konsol Çıktısı</span>
                            <span id="processingIndicator" class="hidden text-[10px] text-emerald-500 bg-emerald-500/10 px-1.5 py-0.5 rounded animate-pulse">İşleniyor</span>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <select id="outputFormat" onchange="processNames()" class="bg-slate-700 border border-slate-600 text-slate-300 text-[10px] rounded px-2 py-1 outline-none hover:border-slate-500">
                                <option value="plain">Text (.txt)</option>
                                <option value="sql">SQL List</option>
                                <option value="json">JSON Array</option>
                                <option value="csv">CSV</option>
                            </select>
                            <div class="h-4 w-px bg-slate-700 mx-1"></div>
                            <button onclick="copyResult()" id="copyBtn" class="btn-modern px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-500 text-white text-[10px] font-bold shadow-lg shadow-emerald-900/50">
                                <i class="fa-regular fa-copy mr-1"></i> KOPYALA
                            </button>
                        </div>
                    </div>

                    <!-- Console View -->
                    <div class="relative flex-grow bg-[#0f172a] group">
                        <div id="resultArea" class="absolute inset-0 p-4 font-mono text-xs sm:text-sm text-emerald-400 overflow-y-auto whitespace-pre leading-relaxed dark-scroll select-all">
                            <span class="text-slate-600 italic select-none opacity-50">// Sonuçlar burada görüntülenecek...</span>
                        </div>
                        
                        <!-- Floating Download Actions -->
                        <div class="absolute bottom-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                             <button onclick="downloadText()" class="w-8 h-8 rounded-lg bg-slate-800 border border-slate-600 text-slate-400 hover:text-white hover:border-slate-400 flex items-center justify-center shadow-lg transition-colors" title="TXT İndir">
                                <i class="fa-solid fa-file-lines"></i>
                            </button>
                            <button onclick="downloadExcel()" class="w-8 h-8 rounded-lg bg-slate-800 border border-slate-600 text-green-500 hover:text-green-400 hover:border-green-500 flex items-center justify-center shadow-lg transition-colors" title="Excel İndir">
                                <i class="fa-solid fa-file-excel"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Status Bar -->
                    <div class="px-3 py-1 bg-slate-900 border-t border-slate-800 flex justify-between items-center text-[10px] text-slate-500 font-mono">
                         <div id="statsDisplay" class="flex gap-3">
                            <span>Ln 0</span>
                            <span>Col 0</span>
                        </div>
                        <div>UTF-8</div>
                    </div>
                </div>
                
            </div>

        </div>
    </main>

    <!-- Logic Script -->
    <script>
        // --- Elements ---
        const inputNames = document.getElementById('inputNames');
        const resultArea = document.getElementById('resultArea');
        const statsDisplay = document.getElementById('statsDisplay');
        const processingIndicator = document.getElementById('processingIndicator');
        const columnSelectionArea = document.getElementById('columnSelectionArea');
        const excelColumnSelect = document.getElementById('excelColumnSelect');
        const outputFormatSelect = document.getElementById('outputFormat'); 
        
        // Settings
        const firstNameRange = document.getElementById('firstNameRange');
        const lastNameRange = document.getElementById('lastNameRange');
        const firstNameVal = document.getElementById('firstNameVal');
        const lastNameVal = document.getElementById('lastNameVal');
        const maskCharSelect = document.getElementById('maskChar');
        const middleNameFullMask = document.getElementById('middleNameFullMask');
        const fixedLengthMask = document.getElementById('fixedLengthMask');
        const randomMode = document.getElementById('randomMode');

        let globalExcelData = null;

        // --- Event Listeners ---
        const inputs = [inputNames, firstNameRange, lastNameRange, maskCharSelect, middleNameFullMask, fixedLengthMask, randomMode, outputFormatSelect];
        
        inputs.forEach(input => {
            input.addEventListener('input', () => {
                showProcessing();
                setTimeout(processNames, 50); 
            });
        });

        firstNameRange.addEventListener('input', () => firstNameVal.innerText = `${firstNameRange.value} Harf`);
        lastNameRange.addEventListener('input', () => lastNameVal.innerText = `${lastNameRange.value} Harf`);

        // --- Core Functions ---

        function showProcessing() {
            processingIndicator.classList.remove('hidden');
        }

        function processNames() {
            const rawText = inputNames.value;
            
            if (!rawText.trim()) {
                resultArea.innerHTML = '<span class="text-slate-600 italic select-none opacity-50">// Sonuçlar burada görüntülenecek...</span>';
                updateStats(0, 0);
                processingIndicator.classList.add('hidden');
                return;
            }

            const lines = rawText.split('\n');
            const format = outputFormatSelect.value; 

            const processedLines = lines.map(line => {
                if (!line.trim()) return ''; 
                
                // 1. Maskele
                let masked = maskLine(line.trim());

                // 2. Formatla
                if (masked && !masked.includes("Lütfen işleme devam")) {
                    if (format === 'sql') return `'${masked}',`;
                    if (format === 'json') return `"${masked}",`;
                    if (format === 'csv') return `${masked};`;
                }
                
                return masked;
            });

            resultArea.innerText = processedLines.join('\n');
            
            const nonEmptyLines = lines.filter(l => l.trim().length > 0).length;
            updateStats(nonEmptyLines, rawText.length);
            
            processingIndicator.classList.add('hidden');
        }

        function updateStats(lines, chars) {
            statsDisplay.innerHTML = `
                <span>Ln ${lines}</span>
                <span>Ch ${chars}</span>
            `;
        }

        function maskLine(fullName) {
            if (fullName.includes("Lütfen işleme devam etmek için")) return fullName;

            const parts = fullName.split(/\s+/);
            const maskChar = maskCharSelect.value;
            const isFixed = fixedLengthMask.checked;
            const isRandom = randomMode.checked;
            const isMiddleFull = middleNameFullMask.checked;

            let fShow = parseInt(firstNameRange.value);
            let lShow = parseInt(lastNameRange.value);

            if (isRandom) {
                fShow = Math.floor(Math.random() * 3) + 1; 
                lShow = Math.floor(Math.random() * 3) + 1;
            }

            // 1. Single Name
            if (parts.length === 1) {
                return applyMask(parts[0], fShow, maskChar, isFixed);
            }
            // 2. First + Last
            if (parts.length === 2) {
                const first = applyMask(parts[0], fShow, maskChar, isFixed);
                const last = applyMask(parts[1], lShow, maskChar, isFixed);
                return `${first} ${last}`;
            }
            // 3. First + Middle + Last
            if (parts.length === 3) {
                const first = applyMask(parts[0], fShow, maskChar, isFixed);
                const last = applyMask(parts[2], lShow, maskChar, isFixed);
                let middle = "";
                if (isMiddleFull) {
                    middle = isFixed ? (maskChar.repeat(3)) : (maskChar.repeat(parts[1].length));
                } else {
                    let mShow = isRandom ? Math.floor(Math.random() * 2) : fShow;
                    middle = applyMask(parts[1], mShow, maskChar, isFixed);
                }
                return `${first} ${middle} ${last}`;
            }
            // 4. Complex (4+ names)
            if (parts.length > 3) {
                const first = applyMask(parts[0], fShow, maskChar, isFixed);
                const last = applyMask(parts[parts.length - 1], lShow, maskChar, isFixed);
                const middles = parts.slice(1, parts.length - 1).map(m => {
                    if (isMiddleFull) {
                         return isFixed ? (maskChar.repeat(3)) : (maskChar.repeat(m.length));
                    } else {
                         return applyMask(m, 1, maskChar, isFixed); 
                    }
                });
                return `${first} ${middles.join(' ')} ${last}`;
            }
            return fullName;
        }

        function applyMask(word, visibleCount, char, isFixed) {
            if (word.length <= visibleCount) {
                if(word.length > 1) {
                    return word.substring(0, 1) + (isFixed ? char.repeat(3) : char.repeat(word.length - 1));
                }
                return word;
            }
            const prefix = word.substring(0, visibleCount);
            const suffixLength = word.length - visibleCount;
            const maskString = isFixed ? char.repeat(3) : char.repeat(suffixLength);
            return prefix + maskString;
        }

        // --- File I/O & Excel ---

        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;

            const fileName = file.name.toLowerCase();

            if (fileName.endsWith('.xls') || fileName.endsWith('.xlsx')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    globalExcelData = jsonData;
                    populateColumnSelector(jsonData);
                    inputNames.value = "Excel dosyası başarıyla okundu.\n\nLütfen işleme devam etmek için yukarıdaki 'Excel Algılandı' panelinden bir sütun seçiniz...";
                    processNames(); 
                };
                reader.readAsArrayBuffer(file);
            } else {
                const reader = new FileReader();
                reader.onload = function(e) {
                    columnSelectionArea.classList.add('hidden');
                    globalExcelData = null;
                    inputNames.value = e.target.result;
                    processNames();
                };
                reader.readAsText(file, "UTF-8");
            }
            input.value = '';
        }

        function populateColumnSelector(data) {
            if(!data || data.length === 0) return;
            let maxCols = 0;
            const checkRows = Math.min(data.length, 5);
            for(let i=0; i<checkRows; i++){
                if(data[i] && data[i].length > maxCols) maxCols = data[i].length;
            }
            excelColumnSelect.innerHTML = '<option value="-1" selected disabled>-- Sütun Seçiniz --</option>';
            for (let i = 0; i < maxCols; i++) {
                const option = document.createElement('option');
                option.value = i;
                let headerName = "";
                if (data[0] && data[0][i]) {
                    let val = String(data[0][i]);
                    if(val.length > 20) val = val.substring(0, 17) + "...";
                    headerName = ` (${val})`;
                }
                const colLetter = getExcelColLetter(i);
                option.text = `Sütun ${colLetter}${headerName}`;
                excelColumnSelect.appendChild(option);
            }
            columnSelectionArea.classList.remove('hidden');
        }

        function getExcelColLetter(colIndex) {
            let letter = '';
            while (colIndex >= 0) {
                letter = String.fromCharCode((colIndex % 26) + 65) + letter;
                colIndex = Math.floor(colIndex / 26) - 1;
            }
            return letter;
        }

        function loadSelectedColumn() {
            if (!globalExcelData) return;
            const colIndex = parseInt(excelColumnSelect.value);
            if (colIndex === -1) return; 
            const textContent = globalExcelData.map(row => {
                return row[colIndex] ? String(row[colIndex]).trim() : "";
            }).filter(line => line.length > 0).join('\n');
            inputNames.value = textContent;
            processNames();
        }

        function downloadText() {
            const text = resultArea.innerText;
            if (!text || text.includes("Sonuçlar burada") || text.includes("Lütfen işleme devam etmek") || text.includes("Çıktı bekleniyor")) {
                alert("İndirilecek geçerli veri yok!");
                return;
            }
            const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "maskelenmis_liste.txt";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadExcel() {
            const text = resultArea.innerText;
            if (!text || text.includes("Sonuçlar burada") || text.includes("Lütfen işleme devam etmek") || text.includes("Çıktı bekleniyor")) {
                alert("İndirilecek geçerli veri yok!");
                return;
            }
            const lines = text.split('\n');
            const data = lines.map(line => [line]); 
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([["Maskelenmiş İsimler"], ...data]); 
            XLSX.utils.book_append_sheet(wb, ws, "Maskelenmiş Liste");
            XLSX.writeFile(wb, "maskelenmis_liste.xlsx");
        }

        // --- Formatting & Tools Utils ---

        function changeCase(type) {
            const text = inputNames.value;
            if(!text) return;
            if (type === 'upper') {
                inputNames.value = text.toLocaleUpperCase('tr-TR');
            } else if (type === 'lower') {
                inputNames.value = text.toLocaleLowerCase('tr-TR');
            } else if (type === 'title') {
                inputNames.value = text.toLowerCase().split('\n').map(line => {
                    return line.split(' ').map(word => 
                        word.charAt(0).toLocaleUpperCase('tr-TR') + word.slice(1).toLocaleLowerCase('tr-TR')
                    ).join(' ');
                }).join('\n');
            }
            processNames();
        }

        function removeDuplicates() {
            const text = inputNames.value;
            if (!text) return;
            
            const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
            const uniqueLines = [...new Set(lines)];
            
            if (lines.length === uniqueLines.length) {
                alert("Mükerrer kayıt bulunamadı.");
            } else {
                const removedCount = lines.length - uniqueLines.length;
                inputNames.value = uniqueLines.join('\n');
                processNames();
                alert(`${removedCount} adet mükerrer kayıt temizlendi.`);
            }
        }

        function sortInput(direction) {
            const text = inputNames.value;
            if (!text) return;
            
            let lines = text.split('\n').filter(l => l.trim().length > 0);
            
            if (direction === 'asc') {
                lines.sort((a, b) => a.localeCompare(b, 'tr'));
            } else {
                lines.sort((a, b) => b.localeCompare(a, 'tr'));
            }
            
            inputNames.value = lines.join('\n');
            processNames();
        }

        function clearInput() {
            if(confirm("Tüm veriyi silmek istediğine emin misin?")) {
                inputNames.value = "";
                columnSelectionArea.classList.add('hidden');
                globalExcelData = null;
                processNames();
            }
        }

        function fillSampleData() {
            columnSelectionArea.classList.add('hidden');
            globalExcelData = null;
            const samples = 
`Ahmet Yılmaz
Ayşe Demir
Ahmet Yılmaz
Fatma Nur Kara
Mehmet Can Yıldız
Mustafa Kemal Atatürk
Ali Veli Hasan Hüseyin
Zeynep Sude Çelik
Oğuzhan Koç
İbrahim Tatlıses
Hüseyin Avni Sözen
Abdurrahman Kahraman
Efe Ak
Su Naz`;
            inputNames.value = samples;
            processNames();
        }

        function copyResult() {
            const text = resultArea.innerText;
            if (!text || text.includes("Sonuçlar burada") || text.includes("Lütfen işleme devam etmek")) return;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copyBtn');
                const originalContent = btn.innerHTML;
                btn.innerHTML = '<i class="fa-solid fa-check"></i> KOPYALANDI';
                btn.classList.remove('bg-emerald-600', 'hover:bg-emerald-500');
                btn.classList.add('bg-blue-600');
                setTimeout(() => {
                    btn.innerHTML = originalContent;
                    btn.classList.remove('bg-blue-600');
                    btn.classList.add('bg-emerald-600', 'hover:bg-emerald-500');
                }, 2000);
            });
        }
    </script>
</body>
</html>
